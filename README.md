# 算法团队项目管理系统

一个专为算法团队设计的项目管理系统，支持项目进度跟踪、工时管理、日报填写和AI自动生成周报。

---

## ✨ 功能特性

### 🔐 用户认证与权限
- **JWT Token认证** - 安全的身份验证机制
- **邀请码注册** - 管理员生成邀请码，控制团队成员准入
- **三级角色体系** - 管理员(admin)、经理(manager)、成员(member)
- **细粒度权限控制** - 不同角色对应不同操作权限

### 📁 项目管理
- **项目全生命周期** - 创建、活跃、暂停、归档状态管理
- **项目成员分配** - 添加/移除项目成员，设置项目角色
- **业务方记录** - 记录项目需求来源和业务对接方
- **多维度信息** - 项目编号、优先级、时间范围、负责人

### 📝 会议纪要
- **结构化记录** - 会议标题、时间、地点、参会人员
- **内容管理** - 会议摘要、详细内容记录
- **任务追溯** - 会议纪要作为任务来源的追溯依据
- **关联查询** - 快速查看会议产生的所有任务

### ✅ 任务管理
- **五阶段状态流转** - 待办 → 任务评审 → 进行中 → 成果评审 → 完成
- **评审机制** - 开发前方案评审 + 开发后成果评审
- **干系人管理** - 负责人、评审人、协作者、普通干系人
- **多级任务** - 支持父子任务层级关系
- **工时预估与追踪** - 预估工时 vs 实际工时对比
- **状态变更历史** - 完整记录任务状态流转轨迹
- **审批投票** - 干系人对状态变更进行审批投票

### ⏱️ 日报与工时管理
- **每日工作记录** - 关联项目、任务、工时、工作内容
- **工作类型分类** - 开发、调试、会议、文档、研究、评审等
- **问题与计划** - 记录遇到的问题和明日计划
- **自动工时汇总** - 日报工时自动累计到任务实际工时
- **工时统计分析** - 按日期、项目、任务多维度统计

### 🤖 AI智能周报
- **个人周报** - 基于个人日报数据自动生成
- **项目周报** - 汇总项目所有成员的工作内容
- **四段式结构** - 本周总结、主要成果、问题风险、下周计划
- **可编辑优化** - AI生成后可人工修改完善
- **审核机制** - 支持周报审核与审核人记录
- **原始数据快照** - 保留生成周报时的原始数据

### 🔔 通知系统
- **@提及通知** - 在任务、会议等内容中@成员
- **状态变更通知** - 任务状态变化自动通知相关人员
- **任务分配通知** - 新任务分配时通知负责人
- **评审通知** - 评审请求和结果通知

---

## 📊 核心业务流程

### 整体工作流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              核心业务流程                                    │
└─────────────────────────────────────────────────────────────────────────────┘

  [项目创建] ──→ [会议纪要记录] ──→ [任务创建(关联会议)] ──→ [任务分配]
       │                                      │
       │                                      ▼
       │                             [每日工作执行]
       │                                      │
       │                                      ▼
       │                     [日报填写(关联任务+工时)]
       │                                      │
       │                                      ▼
       │                          ┌──────────────────────┐
       │                          │     任务状态更新      │
       │                          │  (五阶段评审流程)     │
       │                          └──────────────────────┘
       │                                      │
       │                                      ▼
       │                            [AI自动生成周报]
       │                             ├─ 个人周报
       │                             └─ 项目周报
       │                                      │
       └──────────────────────────────────────┘
                        数据闭环
```

### 任务状态流转流程

```
┌──────┐     ┌────────────┐     ┌──────────┐     ┌────────────┐     ┌──────┐
│ 待办  │ ──→ │  任务评审   │ ──→ │  进行中   │ ──→ │  成果评审   │ ──→ │ 完成  │
│ todo │     │task_review │     │in_progress│     │result_review│     │ done │
└──────┘     └────────────┘     └──────────┘     └────────────┘     └──────┘
                  │                   │                  │
                  ▼                   ▼                  ▼
             (打回待办)         (打回任务评审)        (打回进行中)

┌─────────────────────────────────────────────────────────────────────────────┐
│ 评审阶段说明                                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│ • 任务评审（开发前）：评审需求理解、技术方案设计，确认方案可行后再开发         │
│ • 成果评审（开发后）：评审代码逻辑、功能实现、测试结果                        │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 日报填写流程

```
  选择日期 ──→ 添加工作记录 ──→ 选择项目 ──→ 选择任务 ──→ 填写工时
                   │              │            │            │
                   │              │            │            ▼
                   │              │            │      填写工作内容
                   │              │            │            │
                   ▼              ▼            ▼            ▼
             [可添加多条] ─────────────────────────→ 填写今日问题(可选)
                                                          │
                                                          ▼
                                                   填写明日计划(可选)
                                                          │
                                                          ▼
                                                   ┌─────────────┐
                                                   │  保存/提交   │
                                                   └─────────────┘
                                                          │
                                                          ▼
                                               自动更新任务实际工时
```

---

## 🔗 数据层级关系

### 实体关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              数据实体关系                                    │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌──────────────┐
                              │    Member    │
                              │   (成员)      │
                              └──────────────┘
                                     │
          ┌──────────────────────────┼──────────────────────────┐
          │                          │                          │
          ▼                          ▼                          ▼
┌──────────────────┐      ┌──────────────────┐      ┌──────────────────┐
│ InvitationCode   │      │ ProjectMember    │      │  DailyWorkLog    │
│  (邀请码)         │      │ (项目成员关联)   │      │   (日报记录)      │
└──────────────────┘      └──────────────────┘      └──────────────────┘
                                   │                          │
                                   │                          │
                                   ▼                          │
                          ┌──────────────────┐                │
                          │     Project      │                │
                          │     (项目)       │◀───────────────┘
                          └──────────────────┘
                                   │
                  ┌────────────────┼────────────────┐
                  │                │                │
                  ▼                ▼                ▼
       ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐
       │     Meeting      │ │      Task        │ │  WeeklyReport    │
       │   (会议纪要)      │ │     (任务)       │ │    (周报)        │
       └──────────────────┘ └──────────────────┘ └──────────────────┘
                │                   │
                │                   ├─────────────────────────┐
                │                   │                         │
                └───────────────────┤                         │
                                    ▼                         ▼
                          ┌──────────────────┐     ┌──────────────────┐
                          │ TaskStakeholder  │     │TaskStatusHistory │
                          │  (任务干系人)     │     │  (状态变更历史)   │
                          └──────────────────┘     └──────────────────┘
                                                            │
                                                            ▼
                                                  ┌──────────────────┐
                                                  │TaskStatusApproval│
                                                  │   (审批投票)      │
                                                  └──────────────────┘
```

### 层级关系说明

| 层级 | 实体 | 说明 |
|------|------|------|
| **L1 - 组织层** | Member | 团队成员，系统的基础用户单位 |
| **L2 - 项目层** | Project | 项目，管理的核心对象 |
| **L3 - 内容层** | Meeting / Task / WeeklyReport | 项目下的具体内容实体 |
| **L4 - 记录层** | DailyWorkLog / TaskStatusHistory | 操作记录与状态追踪 |
| **L5 - 关联层** | ProjectMember / TaskStakeholder / TaskStatusApproval | 关联关系与审批 |

### 核心关联关系

| 关系 | 说明 |
|------|------|
| `Project ← Meeting` | 一个项目包含多个会议纪要 |
| `Project ← Task` | 一个项目包含多个任务 |
| `Meeting ← Task` | 任务可关联来源会议纪要（可选） |
| `Task ← Task` | 任务支持父子层级（子任务） |
| `Task ← DailyWorkLog` | 日报记录关联具体任务 |
| `Task ← TaskStakeholder` | 任务拥有多个干系人 |
| `Task ← TaskStatusHistory` | 任务状态变更完整记录 |
| `Member ← Project (owner)` | 成员可作为项目负责人 |
| `Member ← Task (assignee)` | 成员可作为任务负责人 |

---

## 👥 角色权限说明

| 角色 | 权限范围 |
|------|----------|
| **admin (管理员)** | 系统配置、成员管理、生成邀请码、全局数据查看与修改 |
| **manager (经理)** | 项目创建与管理、任务分配、项目周报查看、团队日报查看 |
| **member (成员)** | 日报填写、任务状态更新、个人数据查看、被分配任务处理 |

### 干系人角色说明

| 角色 | 说明 | 权限 |
|------|------|------|
| **负责人 (assignee)** | 任务主要执行人 | 更新状态、记录工时、提交评审 |
| **评审人 (reviewer)** | 负责评审的干系人 | 审核通过/打回、填写评审意见 |
| **协作者 (collaborator)** | 参与协作的干系人 | 查看详情、接收通知、记录工时 |
| **干系人 (stakeholder)** | 普通关注人 | 查看详情、接收通知 |

---

## 🏗️ 技术栈

- **后端**: Python 3.11 + FastAPI
- **数据库**: PostgreSQL 15
- **ORM**: SQLAlchemy 2.0
- **认证**: JWT (python-jose)
- **AI**: OpenAI API
- **部署**: Docker + Docker Compose

## 🚀 快速开始

### 方式一：Docker部署（推荐）

```bash
# 1. 克隆项目
git clone <repository-url>
cd project_management

# 2. 配置环境变量
cp backend/env.template backend/.env
# 编辑 .env 文件配置数据库和OpenAI密钥

# 3. 启动服务
docker-compose up -d

# 4. 初始化测试数据（可选）
docker-compose exec backend python scripts/seed_data.py

# 5. 访问API文档
# http://localhost:8000/api/v1/docs
```

### 方式二：本地开发

```bash
# 1. 进入后端目录
cd backend

# 2. 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. 安装依赖
pip install -r requirements.txt

# 4. 配置环境变量
cp env.template .env
# 编辑 .env 文件

# 5. 启动PostgreSQL数据库
# 确保本地PostgreSQL已运行

# 6. 初始化数据库并启动
python scripts/start.py --init-db --reload

# 7. 创建测试数据（可选）
python scripts/seed_data.py
```

## 📖 API文档

启动服务后访问：
- Swagger UI: http://localhost:8000/api/v1/docs
- ReDoc: http://localhost:8000/api/v1/redoc

### 主要API模块

| 模块 | 路径 | 说明 |
|-----|-----|------|
| 认证 | `/api/v1/auth` | 登录、注册、修改密码 |
| 成员 | `/api/v1/members` | 成员CRUD |
| 项目 | `/api/v1/projects` | 项目和成员管理 |
| 会议 | `/api/v1/meetings` | 会议纪要CRUD |
| 任务 | `/api/v1/tasks` | 任务和干系人管理 |
| 日报 | `/api/v1/daily` | 工时记录和日报 |
| 周报 | `/api/v1/weekly-reports` | AI周报生成 |

## 📋 任务状态详解

### 状态定义

| 状态 | 英文标识 | 说明 |
|------|----------|------|
| 待办 | `todo` | 任务已创建，等待启动 |
| 任务评审 | `task_review` | 提交方案评审，等待干系人审核 |
| 进行中 | `in_progress` | 评审通过，正在开发执行 |
| 成果评审 | `result_review` | 开发完成，提交成果验收 |
| 完成 | `done` | 评审通过，任务结束 |
| 已取消 | `cancelled` | 任务被取消（特殊状态） |

### 状态变更权限

| 状态变更 | 触发条件 | 操作权限 |
|----------|----------|----------|
| 待办 → 任务评审 | 提交需求/方案评审 | 任务负责人 |
| 任务评审 → 待办 | 评审不通过 | 评审人/项目负责人 |
| 任务评审 → 进行中 | 评审通过 | 评审人/项目负责人 |
| 进行中 → 成果评审 | 开发完成 | 任务负责人 |
| 成果评审 → 进行中 | 评审不通过 | 评审人/项目负责人 |
| 成果评审 → 完成 | 评审通过 | 评审人/项目负责人 |

## 🗂️ 项目结构

```
project_management/
├── backend/                 # 后端代码
│   ├── app/
│   │   ├── api/            # API路由
│   │   ├── core/           # 核心配置
│   │   ├── models/         # 数据模型
│   │   ├── schemas/        # Pydantic模型
│   │   ├── services/       # 业务服务
│   │   └── main.py         # 入口
│   ├── alembic/            # 数据库迁移
│   ├── scripts/            # 脚本
│   ├── Dockerfile
│   └── requirements.txt
├── prototype/              # 前端原型
├── docs/                   # 文档
├── docker-compose.yml
└── README.md
```

## ⚙️ 环境变量

| 变量 | 说明 | 默认值 |
|-----|------|-------|
| `DATABASE_URL` | PostgreSQL连接字符串 | - |
| `SECRET_KEY` | JWT密钥 | - |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | Token过期时间 | 1440 |
| `OPENAI_API_KEY` | OpenAI API密钥 | - |
| `OPENAI_MODEL` | AI模型 | gpt-4 |
| `OPENAI_BASE_URL` | API代理地址 | - |

## 🛠️ 开发命令

```bash
# 数据库迁移
alembic revision --autogenerate -m "描述"
alembic upgrade head

# 创建测试数据
python scripts/seed_data.py

# 开发模式启动
python scripts/start.py --reload

# Docker开发模式
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
```

---

## 🎯 快速上手指南

### 首次使用流程

```
1️⃣ 管理员登录 ──→ 2️⃣ 生成邀请码 ──→ 3️⃣ 成员注册 ──→ 4️⃣ 创建项目
                                                            │
                                                            ▼
    8️⃣ 查看周报 ◀── 7️⃣ AI生成周报 ◀── 6️⃣ 填写日报 ◀── 5️⃣ 创建任务
```

### 日常工作流程

| 步骤 | 操作 | 说明 |
|------|------|------|
| 1 | 查看待办任务 | 进入"我的任务"查看分配给自己的任务 |
| 2 | 更新任务状态 | 开始工作前将任务状态改为"进行中" |
| 3 | 执行开发工作 | 按任务要求进行开发 |
| 4 | 填写日报 | 每日下班前填写当天的工作记录和工时 |
| 5 | 提交评审 | 任务完成后提交成果评审 |
| 6 | 查看周报 | 周末前可生成和查看AI周报 |

### 管理员专属操作

| 操作 | 入口 | 说明 |
|------|------|------|
| 成员管理 | `/api/v1/members` | 查看、编辑、禁用团队成员 |
| 生成邀请码 | `/api/v1/invitation-codes` | 生成新成员注册邀请码 |
| 项目管理 | `/api/v1/projects` | 创建项目、分配成员 |
| 查看团队日报 | `/api/v1/daily` | 查看所有成员的日报记录 |

### 常用API示例

#### 登录获取Token

```bash
curl -X POST "http://localhost:8000/api/v1/auth/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin@example.com&password=your_password"
```

#### 创建项目

```bash
curl -X POST "http://localhost:8000/api/v1/projects" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"name": "项目名称", "description": "项目描述", "priority": "high"}'
```

#### 填写日报

```bash
curl -X POST "http://localhost:8000/api/v1/daily/work-logs" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "task_id": 1,
    "project_id": 1,
    "work_date": "2026-01-16",
    "hours": 4.0,
    "description": "完成XXX功能开发",
    "work_type": "development"
  }'
```

#### 生成AI周报

```bash
curl -X POST "http://localhost:8000/api/v1/weekly-reports/generate" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"report_type": "personal", "week_start": "2026-01-13", "week_end": "2026-01-17"}'
```

---

## 📚 更多文档

| 文档 | 路径 | 说明 |
|------|------|------|
| 产品规格说明 | `docs/SPEC.md` | 详细的功能规格与设计说明 |
| API规范文档 | `docs/api_specification.md` | 完整的API接口规范 |
| 数据库设计 | `docs/database_schema.sql` | 数据库表结构设计 |
| 页面线框图 | `docs/wireframes.md` | UI/UX设计线框图 |

## 📄 许可证

MIT License
